using System;
using System.IO;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;
using System.Diagnostics;

namespace Logo8_Starter
{
    /// <summary>
    /// Interaktionslogik für MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {

        string ProjektName = "";

        public MainWindow()
        {
            InitializeComponent();
            ProjekteLesen();
        }

        public void ProjekteLesen()
        {
            List<string> ProjektVerzeichnis = new List<string>();
            List<string> Projekte_PLC_NONE_NONE = new List<string>();
            List<string> Projekte_BUG_NONE_NONE = new List<string>();

            System.IO.DirectoryInfo ParentDirectory = new System.IO.DirectoryInfo("Projekte");

            foreach (System.IO.DirectoryInfo d in ParentDirectory.GetDirectories())
                ProjektVerzeichnis.Add(d.Name);

            ProjektVerzeichnis.Sort();

            foreach (string Projekt in ProjektVerzeichnis)
            {
                int TextLaenge = 0;

                RadioButton rdo = new RadioButton();
                rdo.GroupName = "Logo8!";
                rdo.VerticalAlignment = VerticalAlignment.Top;
                rdo.Checked += new RoutedEventHandler(radioButton_Checked);

                if (Projekt.Contains("PLC_NONE_NONE"))
                {
                    TextLaenge = 25;
                    rdo.Content = Projekt.Substring(TextLaenge).Replace("_", " ");
                    rdo.Name = Projekt;
                    StackPanel_PLC_NONE_NONE.Children.Add(rdo);
                }

                if (Projekt.Contains("BUG_NONE_NONE"))
                {
                    TextLaenge = 24;
                    rdo.Content = Projekt.Substring(TextLaenge).Replace("_", " ");
                    rdo.Name = Projekt;
                    StackPanel_BUG_NONE_NONE.Children.Add(rdo);
                }

            }




        }

        private void radioButton_Checked(object sender, RoutedEventArgs e)
        {
            RadioButton rb = sender as RadioButton;

            System.IO.DirectoryInfo ParentDirectory = new System.IO.DirectoryInfo("Projekte");

            ProjektStarten_PLC_NONE_NONE.IsEnabled = true;
            ProjektStarten_BUG_NONE_NONE.IsEnabled = true;

            ProjektStarten_PLC_NONE_NONE.Background = new SolidColorBrush(Colors.Green);
            ProjektStarten_BUG_NONE_NONE.Background = new SolidColorBrush(Colors.Green);


            ProjektName = rb.Name;

            string DateiName = ParentDirectory.FullName + "\\" + rb.Name + "\\index.html";
            string HtmlSeite = System.IO.File.ReadAllText(DateiName);
            string LeereHtmlSeite = "<!doctype html>   </html >";

            if (rb.Name.Contains("PLC_NONE_NONE"))
                Web_PLC_NONE_NONE.NavigateToString(HtmlSeite);
            else
                Web_PLC_NONE_NONE.NavigateToString(LeereHtmlSeite);

            if (rb.Name.Contains("BUG_NONE_NONE"))
                Web_BUG_NONE_NONE.NavigateToString(HtmlSeite);
            else
                Web_BUG_NONE_NONE.NavigateToString(LeereHtmlSeite);



        }

        private void ProjektStarten(object sender, RoutedEventArgs e)
        {

            System.IO.DirectoryInfo ParentDirectory = new System.IO.DirectoryInfo("Projekte");
            string sourceDirectory = ParentDirectory.FullName + "\\" + ProjektName;
            string targetDirectory = "h:\\Logo8";

            if (System.IO.Directory.Exists(targetDirectory)) System.IO.Directory.Delete(targetDirectory, true);
            System.IO.Directory.CreateDirectory(targetDirectory);

            Copy(sourceDirectory, targetDirectory);

            // Process.Start("cmd.exe", "h:\\TwinCAT_V3\\start.cmd");

            Process proc = new Process();
            proc.StartInfo.FileName = @"h:\Logo8\start.cmd";
            proc.StartInfo.WorkingDirectory = @"h:\Logo8";
            proc.Start();


        }


        public static void Copy(string sourceDirectory, string targetDirectory)
        {
            DirectoryInfo diSource = new DirectoryInfo(sourceDirectory);
            DirectoryInfo diTarget = new DirectoryInfo(targetDirectory);

            CopyAll(diSource, diTarget);
        }

        public static void CopyAll(DirectoryInfo source, DirectoryInfo target)
        {
            Directory.CreateDirectory(target.FullName);

            // Copy each file into the new directory.
            foreach (FileInfo fi in source.GetFiles())
            {
                Console.WriteLine(@"Copying {0}\{1}", target.FullName, fi.Name);
                fi.CopyTo(System.IO.Path.Combine(target.FullName, fi.Name), true);
            }

            // Copy each subdirectory using recursion.
            foreach (DirectoryInfo diSourceSubDir in source.GetDirectories())
            {
                DirectoryInfo nextTargetSubDir =
                    target.CreateSubdirectory(diSourceSubDir.Name);
                CopyAll(diSourceSubDir, nextTargetSubDir);
            }
        }


        private void TabControl_SelectionChanged(object sender, RoutedEventArgs e)
        {
            ProjektStarten_PLC_NONE_NONE.Background = new SolidColorBrush(Colors.Gray);
            ProjektStarten_BUG_NONE_NONE.Background = new SolidColorBrush(Colors.Gray);

            ProjektStarten_PLC_NONE_NONE.IsEnabled = false;
            ProjektStarten_BUG_NONE_NONE.IsEnabled = false;

            string LeereHtmlSeite = "<!doctype html>   </html >";
            Web_PLC_NONE_NONE.NavigateToString(LeereHtmlSeite);
            Web_BUG_NONE_NONE.NavigateToString(LeereHtmlSeite);
        }

    }
}

